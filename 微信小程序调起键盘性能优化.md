# 微信小程序调起键盘性能优化
项目中有一个需求，是从首页点击评论按钮进入详情时，在加载完页面后自动调起键盘进入评论状态。从需求来看，我们应该在onReady函数中调起键盘，因为onReady函数实在页面初次渲染完成时被调用。但是在实践中我们发现，对于一些配置不好的手机，其加载页面速度较慢，在onReady函数调用时页面并没有渲染完毕，就会导致如下现象。（placeholder位置错乱。）

其本质原因是，onReady函数并不能在调用时并不能承若已经将页面渲染完成了。
之前的操作是在onReady函数中调起键盘。

```javascript
this.setData({ focus: true })
```
发现这个问题后做了相应的延迟处理

```javascript
setTimeout(() => {
  this.setData({ focus: true })
}, 300)
```
但这是治标不治本的方法，手机性能好的用户会无谓的等待300毫秒，而手机性能很差的用户等待300毫秒也不够用。
那么既然小程序并没有提供给我们一个理想的渲染结束后的回调函数，那么我们就换个思路使用短轮询来处理，当页面渲染完成后才调起键盘的操作。

既然要使用短轮询，那么我们去轮询什么呢？什么标志代表着页面渲染完成了呢？我是使用`wx.createSelectorQuery()`，它会返回一个SelectorQuery对象实例，在这个实例上调用select方法选择我想要去轮询的节点，在回调函数中判断参数是否为`null`。如果返回了监控的节点信息，那么说明已经渲染完成。这时就可以进行键盘调起操作了。

在此之上，如果我们只粗暴的让`focus`为`true`并不是个明智的做法。

因为如果在评论很少的情况下，页面会上推。所以需要判断一个高度，超过这个值就上推，没超过就不上推。
上推的操作是由input组件的`adjust-position`属性决定，为true则上推，否则则不上推。这时回调返回的参数中的节点信息就可以派上用场了。

## onBlur函数问题

## 封装起来